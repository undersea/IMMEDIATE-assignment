<?xml version="1.0" encoding="UTF-8"?>
<beans 
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:aop="http://www.springframework.org/schema/aop"
  xmlns:tx="http://www.springframework.org/schema/tx"
  xmlns="http://www.springframework.org/schema/beans"
       
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd
http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd"
  default-autowire="byType">

  <bean id="subjectDao" class="immediate.learning.support.dao.JpaSubjectDao">
    <property name="entityManagerFactory" ref="entityManagerFactory"/>
  </bean>

  <bean id="categoryDao" class="immediate.learning.support.dao.JpaDao">
    <property name="entityManagerFactory" ref="entityManagerFactory"/>
    <constructor-arg>
      <value>immediate.learning.support.entity.Category</value>
    </constructor-arg>
  </bean>

  <bean id="categoryNamesDao" class="immediate.learning.support.dao.JpaDao">
    <property name="entityManagerFactory" ref="entityManagerFactory"/>
    <constructor-arg>
        <value>immediate.learning.support.entity.CategoryNames</value>
    </constructor-arg>
  </bean>

  <bean id="categoryDescriptorDao" class="immediate.learning.support.dao.JpaCategoryDescriptorDao">
    <property name="entityManagerFactory" ref="entityManagerFactory"/>
    <!--<constructor-arg>
      <value>immediate.learning.support.entity.CategoryDescriptor</value>
    </constructor-arg>-->
  </bean>

  <bean id="conceptDao" class="immediate.learning.support.dao.JpaDao">
    <property name="entityManagerFactory" ref="entityManagerFactory"/>
    <constructor-arg>
        <value>immediate.learning.support.entity.Concept</value>
    </constructor-arg>
  </bean>

  <bean id="supportDao" class="immediate.learning.support.dao.JpaDao">
    <property name="entityManagerFactory" ref="entityManagerFactory"/>
    <constructor-arg>
        <value>immediate.learning.support.entity.Support</value>
    </constructor-arg>
  </bean>

  <bean id="supportInstanceDao" class="immediate.learning.support.dao.JpaDao">
    <property name="entityManagerFactory" ref="entityManagerFactory"/>
    <constructor-arg>
        <value>immediate.learning.support.entity.SupportInstance</value>
    </constructor-arg>
  </bean>

  <bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
    <property name="dataSource" ref="dataSource"/>
    <property name="jpaVendorAdapter">
      <bean class="org.springframework.orm.jpa.vendor.TopLinkJpaVendorAdapter">
        <property name="showSql" value="true"/>
        <property name="generateDdl" value="true"/>
        <property name="databasePlatform" value="oracle.toplink.essentials.platform.database.HSQLPlatform"/>
      </bean>
    </property>
    <property name="loadTimeWeaver">
      <bean class="org.springframework.instrument.classloading.InstrumentationLoadTimeWeaver"/>
    </property>
  </bean>


  <!--<bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">-->
  <bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close">
    <property name="driverClassName" value="org.hsqldb.jdbcDriver"/>
    <property name="url" value="jdbc:hsqldb:hsql:immediate;shutdown=true"/>
    <property name="username" value="sa"/>
    <property name="password" value=""/>
    
  </bean>

  <bean id="transactionManager" class="org.springframework.orm.jpa.JpaTransactionManager">
    <property name="entityManagerFactory" ref="entityManagerFactory"/>
    <property name="dataSource" ref="dataSource"/>
  </bean>

  <!-- This tells Spring to activate annotation-driven transactions -->
  <tx:annotation-driven/>

  <tx:advice id="txAdvice" transaction-manager="transactionManager">
    <tx:attributes>
      <tx:method name="get*" read-only="true"/>
      <tx:method name="*"/>
    </tx:attributes>
  </tx:advice>
  
  <aop:config>
    <aop:pointcut id="serviceOperation" expression="execution(* immediate.learning.service.*.*(..))"/>
    <aop:advisor advice-ref="txAdvice" pointcut-ref="serviceOperation"/>
  </aop:config>	

  <bean id="transService"
        class="immediate.learning.support.service.ServiceImpl"/>
  
</beans>
